package conan.ci.step

@Library('demo_jenkins_library') _

pipeline {
    agent any
    stages {
        stage('test_windows') {
            environment {
                DEMO_RUN_AGENT_OS = "windows" // auto-detected if not supplied
                DEMO_DOCKER_IMAGE = "windows_image"
                DEMO_DOCKER_CONTAINER_OS = "windows" // auto-detected if not supplied
                BUILD_TAG = "JENKINS-LIBA-MASTER_10a" // JPU doesn't set this automatically like real jenkins
                STAGE_NAME = "test_windows" // JPU doesn't set this automatically like real jenkins
            }
            steps {
                withDemoDockerContainer {
                    demoRun(command: "cd")
                    dockerCpToContainer(src: "somesrc", dst: "somedst")
                    dockerCpFromContainer(src: "somesrc", dst: "somedst")
                }
            }
        }
        stage('test_cross') {
            environment{
                DEMO_RUN_AGENT_OS = "windows" // auto-detected if not supplied
                DEMO_DOCKER_IMAGE = "linux_image"
                DEMO_DOCKER_CONTAINER_OS = "linux" // auto-detected if not supplied
                BUILD_TAG = "JENKINS-LIBA-MASTER_10b" // JPU doesn't set this automatically like real jenkins
                STAGE_NAME = "test_cross" // JPU doesn't set this automatically like real jenkins
            }
            steps {
                withDemoDockerContainer{
                    demoRun(command: "pwd")
                    dockerCpToContainer(src: "somesrc", dst: "somedst")
                    dockerCpFromContainer(src: "somesrc", dst: "somedst")
                }
            }
        }
        stage('test_linux') {
            environment{
                DEMO_RUN_AGENT_OS = "linux" // auto-detected if not supplied
                DEMO_DOCKER_IMAGE = "linux_image"
                DEMO_DOCKER_CONTAINER_OS = "linux" // auto-detected if not supplied
                BUILD_TAG = "JENKINS-LIBA-MASTER_10" // JPU doesn't set this automatically like real jenkins
                STAGE_NAME = "test_linux" // JPU doesn't set this automatically like real jenkins
            }
            steps {
                withDemoDockerContainer{
                    demoRun(command: "pwd")
                    dockerCpToContainer(src: "somesrc", dst: "somedst")
                    dockerCpFromContainer(src: "somesrc", dst: "somedst")
                }
            }
        }
    }
}