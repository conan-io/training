package conan.ci.step

@Library('demo_jenkins_library') _

pipeline {
    agent any
    environment {
        WORKSPACE = "." // This variable is auto-created by jenkins
        DEMO_LOG_LEVEL = "DEBUG"
        DEMO_GIT_CREDS = "usr:psw"
        DEMO_GIT_CREDS_USR = "usr"
        DEMO_GIT_CREDS_PSW = "psw"
        DEMO_WORKING_SUBDIR = "project"
        DEMO_CONAN_USER = "MYUSER"
        DEMO_CONAN_CHANNEL = "MYCHANNEL"
        DEMO_CONAN_LOCKFILE = "conan.lock"
        DEMO_CONAN_CONFIG_URL = "http://gitbucket/git/root/settings.git"
    }
    stages {
        stage('linux_gcc_7_debug_x64') {
            environment {
                DEMO_RUN_AGENT_OS = "windows" // auto-detected if not supplied
                DEMO_DOCKER_IMAGE = "windows_image"
                DEMO_DOCKER_CONTAINER_OS = "windows" // auto-detected if not supplied
                BUILD_TAG = "JENKINS-APP-MASTER_10a" // JPU doesn't set this automatically like real jenkins
                STAGE_NAME = "linux_gcc_7_debug_x64" // JPU doesn't set this automatically like real jenkins
                DEMO_DOCKER_IMAGE = "conanio/gcc7"
                DEMO_CONAN_PROFILES = "debug-gcc7-with-new-libA-option"
            }
            steps {
                withCleanWorkspace {
                    withDemoDockerContainer {
                        conanCreateAndUpload()
                    }
                }
            }
        }
    }
}